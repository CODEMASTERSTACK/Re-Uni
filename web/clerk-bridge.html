<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Signing you in...</title>
  <style>
    body { font-family: system-ui, sans-serif; background: #111; color: #eee; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
    .box { text-align: center; }
    .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top-color: #f44; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 1rem; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .err { color: #f66; margin-top: 1rem; }
    a { color: #6af; }
  </style>
</head>
<body>
  <div class="box">
    <div class="spinner"></div>
    <p>Signing you in...</p>
    <p id="err" class="err" style="display:none;"></p>
    <p id="link" style="display:none;"><a id="appLink" href="/">Continue to app</a></p>
  </div>
  <script src="https://unpkg.com/@clerk/clerk-js@latest/dist/clerk.browser.js" crossorigin="anonymous"></script>
  <script>
    (async function() {
      var appOrigin = location.origin;
      var appRoot = appOrigin + '/';
      function goToApp(jwt) {
        var url = jwt ? (appRoot + '?__clerk_db_jwt=' + encodeURIComponent(jwt)) : (appRoot + (location.search || ''));
        location.replace(url);
      }
      function showErr(msg) {
        var el = document.getElementById('err');
        var linkEl = document.getElementById('link');
        if (el) { el.textContent = msg || 'Could not get session token.'; el.style.display = 'block'; }
        if (linkEl) { linkEl.style.display = 'block'; }
        var a = document.getElementById('appLink');
        if (a) a.href = appRoot;
      }
      try {
        if (typeof window.Clerk === 'undefined') {
          showErr('Clerk failed to load.');
          return;
        }
        var publishableKey = 'pk_test_d29ya2luZy10dXJ0bGUtNzQuY2xlcmsuYWNjb3VudHMuZGV2JA';
        var clerk = new window.Clerk(publishableKey);
        await clerk.load();
        var session = clerk.session;
        if (!session) {
          showErr('No session after sign-in. Try again or continue to app.');
          return;
        }
        var token = await session.getToken();
        if (token) {
          goToApp(token);
        } else {
          showErr('Could not get session token.');
        }
      } catch (e) {
        showErr(e && e.message ? e.message : 'Something went wrong.');
      }
    })();
  </script>
</body>
</html>
